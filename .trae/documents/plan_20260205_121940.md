我理解您希望进行一系列深度功能升级，以增强分镜创作的灵活性和专业性。以下是针对您需求的详细升级计划：

### 1. 多角色支持与 @提及功能 (Multi-Character & @Mentions)
*   **数据结构变更**:
    *   `StoryboardFrame` 中的 `characterId` (单数) 将改为 `characterIds` (数组)，支持多选。
    *   在分镜 UI 中，将角色选择器改为多选模式 (Multi-select)。
*   **台词解析增强**:
    *   当用户在“Story Script”或“台词”中输入 `@角色名` 时，系统将自动识别并高亮。
    *   **Prompt 构造逻辑优化**: 在生成图片时，如果检测到 `@角色名`，系统将提取对应角色的**资产描述**（Appearance Description）并强制注入到 Prompt 中，以确保生成的主体一致性。

### 2. API 配置后端化 (Backend Environment Variables)
*   **移除前端配置**: 删除 `SettingsModal` 中手动输入 API Key 的功能（或改为仅在开发模式下显示）。
*   **服务端代理**:
    *   API Key 将统一从 Vercel/本地环境变量 (`process.env`) 读取。
    *   `/api/generate` 和 `/api/analyze-script` 接口将直接使用服务器端的 Key，不再依赖请求头中的 `x-fal-key`。

### 3. 多模型对比生成 (Multi-Model Generation)
*   **模型选择器升级**: 在生成按钮旁增加“模型选择”下拉菜单，支持多选（例如：同时选中 `Fal-Flux` 和 `Fal-SDXL`）。
*   **并行生成**: 点击生成时，后端并发调用选中的所有模型。
*   **结果展示**: 分镜卡片的图片区域将改为**轮播图 (Carousel)** 或 **网格视图**，允许用户左右切换查看不同模型生成的首尾帧，并选择一张作为“最终定稿”。

### 4. 局部重绘 (Inpainting)
*   **交互设计**: 点击已生成的图片，进入“编辑模式”。
*   **功能实现**:
    *   提供画笔工具，用户涂抹想要修改的区域（Mask）。
    *   输入修改提示词（例如：“换成红色领带”）。
    *   调用 Inpainting API (如 Fal 的 Inpainting Endpoint) 进行局部重绘。

### 实施步骤
1.  **API 改造**: 更新 `generate` 路由，支持环境变量读取和多模型并发调用。
2.  **数据层升级**: 修改 `StoryStore` 以支持多角色 ID 和多版本图片结果。
3.  **UI 改造**:
    *   `AssetSelector` 支持多选。
    *   `StoryboardFrame` 支持多图展示和模型选择。
    *   新增 `InpaintingEditor` 组件。
4.  **业务逻辑**: 实现 `@` 解析与 Prompt 注入逻辑。

请确认是否开始执行此计划？