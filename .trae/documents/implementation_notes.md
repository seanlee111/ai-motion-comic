# 实现注意事项

## 1. 前端修改要点

### 1.1 移除duration相关功能
- 从 `StoryboardFrame.tsx` 中移除duration输入框和相关状态管理
- 更新 `StoryboardFrame` 类型定义，移除duration字段
- 更新AI生成逻辑，不再包含duration参数

### 1.2 修复资产选择器问题
- 检查 `AssetSelector` 组件的实现，确保下拉菜单能正确显示可用资产
- 验证资产数据的加载和显示逻辑
- 确保角色资产支持多选功能

### 1.3 模型配置优化
- 在 `ai-models.ts` 中确认Fal.ai模型配置
- 添加IP-Adapter和LoRA支持的相关配置
- 更新模型选择器，仅显示图生图模型

### 1.4 新增分镜创作页面
- 优化 `/script` 页面的用户体验
- 确保AI生成的分镜能正确跳转到工作台
- 添加生成进度指示器

## 2. 后端适配要点

### 2.1 API接口调整
- 更新 `/api/analyze-script` 接口，移除duration生成逻辑
- 确保生成的分镜数据格式与前端兼容
- 添加错误处理和用户提示

### 2.2 Fal.ai模型集成
- 确认FLUX.1 dev和Fast SDXL的图生图能力
- 添加IP-Adapter支持（需要用户提供相应文件）
- 添加LoRA支持（支持flux和SDXL格式）

### 2.3 图像生成逻辑
- 更新图生图逻辑，正确使用参考图像
- 优化提示词生成，结合角色和场景信息
- 添加图像质量控制和后处理

## 3. LoRA文件处理

### 3.1 文件格式支持
- **Flux LoRA**: 支持safetensors格式，需适配FLUX.1 dev模型
- **SDXL LoRA**: 支持safetensors格式，需适配Fast SDXL模型

### 3.2 文件上传和管理
- 需要用户提供的文件：
  - Flux LoRA文件（.safetensors）
  - SDXL LoRA文件（.safetensors）
  - 对应的触发词或描述文本
- 建议创建LoRA资产管理功能

### 3.3 集成方式
- 通过Fal.ai API的LoRA参数传递
- 需要在生成请求中包含LoRA文件URL或ID
- 支持多个LoRA同时使用的配置

## 4. 数据迁移考虑

### 4.1 现有数据兼容
- 保留现有的分镜数据结构
- 向后兼容旧的single URL字段
- 平滑迁移到新的images数组格式

### 4.2 状态管理更新
- 更新Zustand store，移除duration相关状态
- 确保资产选择器的数据流正确
- 优化分镜更新逻辑的性能

## 5. 测试要点

### 5.1 功能测试
- 验证剧本创作页面的AI生成功能
- 测试资产选择器的下拉菜单功能
- 确认图生图模型的正常工作

### 5.2 兼容性测试
- 测试不同浏览器的兼容性
- 验证移动端响应式布局
- 测试文件上传和处理功能

### 5.3 性能测试
- 优化AI请求的并发处理
- 图像加载和缓存策略
- 大数据量分镜的渲染性能